<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Games Over Coffee Lore</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Poppins:wght@700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* Custom scroll behavior for smoother jumps */
        html {
            scroll-behavior: smooth;
        }

        /* Set a custom dark theme using CSS variables */
        :root {
            /* Retain original dark background and nav bar colors */
            --color-goc-darkest: #1f1f1f; /* Darkest background */
            --color-goc-dark: #2b2b2b; /* Card backgrounds, darker accents, new season box background */
            --color-goc-light-accent: #aac6ce; /* Original light accent for nav bar */
            --color-goc-main-text: #ead9ca; /* Original main text color for nav bar */
            --gradient-goc-indigo: linear-gradient(to right, #6366f1, #8b5cf6); /* Original gradient for nav bar active state */
            --color-goc-desaturated-indigo: #4a4d7c; /* Original desaturated indigo for nav bar borders */
            --color-goc-light-indigo-hover: #3c3f6b; /* Original light indigo for nav bar hover */
            /* NEW, SOFTER COLOR PALETTE - Complementary to dark background */
            --color-border-subtle: #3A4452; /* Darker, more desaturated blue for borders and dividers */
            --color-card-border: #303A45; /* Even darker blue-gray for card borders, almost blending */
            --color-hover-bg: #35424D; /* Dark blue-gray for hover backgrounds, very subtle */
            --color-scrollbar-thumb: #50687E; /* Muted, slightly darker blue for scrollbar thumb */
            /* New colors for modal highlights */
            --color-highlight-bg: #3e2f4a; /* A subtle, deeper purple/indigo for highlights */
            --color-highlight-text: #e0ccff; /* Lighter text for highlights */
        }

        /* Custom styles to enhance the theme and readability */
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--color-goc-darkest);
            color: #d1d5db; /* Original light gray text for readability */
            min-height: 100vh;
        }

        /* Headings using original white color for main titles */
        h1 {
            color: white; /* Original white color for h1 */
        }

        /* H2 headings */
        h2 {
            color: #8183f2; /* New color for h2 */
        }

        /* H3 headings */
        h3 {
            color: #b1b9c4; /* Updated color for h3 headings */
        }

        .text-glow {
            text-shadow: 0 0 8px rgba(99, 102, 241, 0.5); /* Subtle text glow */
        }

        .bg-window {
            background-color: var(--color-goc-dark); /* Slightly lighter gray for the main windows */
            border: 1px solid #3c3c3c;
        }

        .text-indigo-highlight {
            color: #6366f1; /* Indigo highlight color */
        }

        .window-scroll {
            /* Enable custom scrollbars for a more integrated look */
            scrollbar-width: thin;
            scrollbar-color: var(--color-scrollbar-thumb) var(--color-goc-dark);
        }

            .window-scroll::-webkit-scrollbar {
                width: 8px;
            }

            .window-scroll::-webkit-scrollbar-track {
                background: var(--color-goc-dark);
            }

            .window-scroll::-webkit-scrollbar-thumb {
                background-color: var(--color-scrollbar-thumb);
                border-radius: 20px;
                border: 2px solid var(--color-goc-dark);
            }
        /* Modal specific styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background-color: var(--color-goc-dark);
            padding: 1.5rem;
            border-radius: 1rem;
            width: 95%;
            max-width: 800px;
            height: 90%;
            display: flex;
            flex-direction: column;
            border: 1px solid #3c3c3c;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 1rem;
            border-bottom: 1px solid #3c3c3c;
            margin-bottom: 1rem;
        }

        .modal-body {
            flex-grow: 1;
            overflow-y: auto;
            padding-right: 1rem; /* Space for the scrollbar */
        }

        /* NEW STYLES FOR VISUAL PLEASING MODAL AND INFO PANEL */
        .section-title { /* Applied to both modal and info-panel for consistency */
            font-weight: bold;
            color: #b1b9c4; /* Updated color for section titles */
            margin-top: 1.5rem; /* Space above each section title */
            margin-bottom: 0.75rem; /* Space below each section title */
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--color-border-subtle); /* Separator line */
            font-size: 1.25rem; /* Slightly larger for section titles */
        }

        .content-block { /* Applied to both modal and info-panel for consistency */
            background-color: var(--color-goc-darkest); /* Slightly darker background for content blocks */
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem; /* Space between content blocks */
            border: 1px solid var(--color-card-border);
        }

            .content-block ul { /* Target lists inside content blocks for custom styling */
                list-style: none; /* Remove default bullet points for custom styling */
                padding-left: 0;
            }

                .content-block ul li { /* Target list items inside content blocks */
                    margin-bottom: 0.5rem; /* Space between list items */
                    padding-left: 1.5rem; /* Indent for custom bullet */
                    position: relative;
                }

                    .content-block ul li::before { /* Custom bullet point inside content blocks */
                        content: "•"; /* Custom bullet point */
                        color: #8183f2; /* New color for bullet points */
                        position: absolute;
                        left: 0;
                    }

        /* Thumbnail styling for both the main info panel and the modal */
        .thumbnail-style { /* A unified class for both thumbnails */
            max-width: 70%; /* Default max width, can be overridden if needed */
            height: auto;
            display: block; /* Ensures margin auto works for centering */
            margin: 1rem auto; /* Center the thumbnail and add vertical space */
            border-radius: 0.75rem; /* Slightly rounded corners for the thumbnail */
            box-shadow: 0 0 15px rgba(99, 102, 241, 0.3); /* Subtle glow effect */
        }

        /* Add a selected state for episode items */
        .episode-item.selected {
            background-color: var(--color-hover-bg); /* A darker indigo to indicate selection */
            color: var(--color-goc-main-text);
        }

            .episode-item.selected p {
                color: #d1d5db; /* Ensure text remains the original light gray on selection */
            }

        /* Responsive adjustments for episode list */
        @media (max-width: 768px) { /* Applies to screens 768px wide or smaller (typical for mobile/tablet) */
            .main { /* Adjust main layout for small screens */
                flex-direction: column; /* Stack main sections vertically */
                overflow-y: auto; /* Allow main content area to scroll vertically if needed */
            }

            #episode-list-window {
                width: 100%; /* Full width for the episode list window */
                margin-right: 0; /* Remove right margin */
                margin-bottom: 1rem; /* Add bottom margin for spacing */
                flex-shrink: 0; /* Prevent this window from shrinking unnecessarily */
            }

                /* Adjusted responsive heading size for episode list */
                #episode-list-window h2 {
                    font-size: 1.5rem; /* Smaller font size for the main "Episodes" heading on small screens */
                    margin-bottom: 0.5rem; /* Reduced margin below heading */
                    padding-bottom: 0.5rem; /* Reduced padding below heading */
                }

            #episode-list {
                /* Removed 'display: flex' from this default state on mobile */
                flex-direction: row; /* Arrange items horizontally */
                overflow-x: auto; /* Enable horizontal scrolling */
                overflow-y: hidden; /* Hide vertical scrolling within the list */
                -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
                /* Collapsible behavior using max-height, opacity, and visibility */
                max-height: 0; /* Collapsed height */
                opacity: 0; /* Collapsed opacity */
                visibility: hidden; /* Hide element and remove from flow when collapsed */
                padding-bottom: 0; /* Start with no padding when collapsed */
                padding-top: 0; /* Start with no padding when collapsed */
                transition: max-height 0.3s ease-out, opacity 0.3s ease-out, padding 0.3s ease-out, visibility 0.3s ease-out;
            }

                #episode-list.expanded {
                    display: flex; /* <-- Add display:flex only when expanded on mobile */
                    max-height: 120px; /* Explicit height for one row of items (adjust this if items are taller) */
                    opacity: 1; /* Fully visible */
                    visibility: visible; /* Make element visible */
                    padding-bottom: 10px; /* Restore padding when expanded */
                    padding-top: 0.5rem; /* Restore padding when expanded */
                }

            .episode-item {
                flex: 0 0 auto; /* Prevent items from shrinking */
                width: 300px; /* Give each item a fixed width for better readability and scrollability */
                margin-right: 1rem; /* Space between horizontal items */
                margin-bottom: 0; /* Remove vertical margin for horizontal items */
                white-space: normal; /* Allow text to wrap within the item */
                border: 1px solid #3c3c3c; /* Add border for better separation */
                box-sizing: border-box; /* Include padding/border in height calculation */
                display: flex; /* Make item a flex container to align its content */
                flex-direction: column; /* Stack title and paragraph vertically within the item */
                justify-content: space-between; /* Distribute space if item height varies */
                padding-top: 0.75rem; /* Adjust padding for better look on horizontal items */
                padding-bottom: 0.75rem;
            }

                .episode-item h3 {
                    font-size: 1.05rem; /* Slightly smaller heading for episode items */
                    margin-bottom: 0.25rem;
                    white-space: normal; /* Ensure text wraps within the heading */
                    overflow: hidden; /* Hide overflow if any, though wrapping should prevent it */
                    text-overflow: ellipsis; /* Add ellipsis if text still overflows on a single line (though it should wrap) */
                }

                .episode-item p {
                    font-size: 0.85rem; /* Slightly smaller paragraph text for episode items */
                    white-space: normal; /* Ensure text wraps within the paragraph */
                    overflow: hidden; /* Hide overflow if any, though wrapping should prevent it */
                    text-overflow: ellipsis; /* Add ellipsis if text still overflows on a single line (though it should wrap) */
                }

            #info-window {
                width: 100%; /* Full width for the info window */
                flex-grow: 1; /* Allow info window to grow and take remaining space */
            }

                /* Adjusted responsive heading size for info window */
                #info-window #info-title {
                    font-size: 1.5rem; /* Smaller font size for info title on small screens */
                    padding-right: 10px; /* Adjust padding right to give button more space */
                }

            #maximize-btn {
                padding: 0.5rem; /* Adjusted padding for the button on small screens */
            }
        }
    </style>
</head>
<body class="flex flex-col h-screen">

    <header class="p-6 bg-color-goc-dark text-color-goc-main-text shadow-lg">
        <div class="container mx-auto flex flex-col sm:flex-row justify-between items-center">
            <h1 class="text-4xl font-extrabold text-color-goc-light-accent font-poppins mb-4 sm:mb-0">Lore Codex</h1>
            <nav class="flex flex-wrap justify-center sm:justify-end gap-3">
                <a href="index.html" class="px-4 py-2 rounded-lg hover:bg-color-goc-light-indigo-hover transition duration-300">Home</a>
                <a href="consulting_site.html" class="px-4 py-2 rounded-lg hover:bg-color-goc-light-indigo-hover transition duration-300">Consulting</a>
                <a href="GOC_lore.html" class="px-4 py-2 rounded-lg bg-gradient-to-r from-indigo-500 to-purple-500 text-white font-semibold transform -translate-y-1 shadow-lg">Lore</a>
            </nav>
        </div>
    </header>

    <main class="flex-grow flex flex-col md:flex-row p-4 md:p-8 overflow-hidden container mx-auto">

        <div id="episode-list-window" class="md:w-1/3 lg:w-1/4 bg-window rounded-xl shadow-lg p-4 md:p-6 mb-4 md:mb-0 md:mr-4 flex flex-col overflow-hidden">
            <div class="flex justify-between items-center mb-4 border-b border-gray-600 pb-2">
                <h2 class="text-xl md:text-2xl font-bold">Episodes</h2>
                <button id="toggle-episodes-btn" class="md:hidden text-indigo-400 hover:text-white transition-colors duration-200">
                    <i class="fa-solid fa-chevron-down text-lg"></i>
                </button>
            </div>

            <ul id="episode-list" class="flex-grow overflow-y-auto window-scroll hidden md:flex-grow">
            </ul>
        </div>

        <div id="info-window" class="md:w-2/3 lg:w-3/4 bg-window rounded-xl shadow-lg p-4 md:p-6 flex flex-col overflow-hidden relative">
            <div class="flex justify-between items-start mb-4 border-b border-gray-600 pb-2 pt-1">
                <h2 id="info-title" class="text-xl md:text-2xl font-bold pr-28">
                    Select an Episode
                </h2>
                <button id="maximize-btn" class="absolute top-4 right-4 bg-transparent text-indigo-400 border border-indigo-500 py-2 px-3 rounded-md hover:bg-indigo-900 hover:border-indigo-400 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 flex items-center justify-center">
                    <i class="fa-solid fa-expand w-4 h-4"></i>
                </button>
            </div>

            <div id="info-content" class="flex-grow overflow-y-auto window-scroll">
                <p id="initial-message" class="text-gray-400 leading-relaxed mb-4">
                    Choose an episode from the list to reveal its full lore, character biographies, and key plot points.
                </p>

                <div id="info-thumbnail-container" class="hidden">
                    <img id="info-thumbnail" src="" alt="Episode Thumbnail" class="thumbnail-style">
                </div>

                <div id="info-synopsis-section"></div>
                <div id="info-characters-section"></div>
                <div id="info-locations-section"></div>
                <div id="episode-lore-section" class="hidden"></div>
                <div id="easter-eggs-section" class="hidden"></div>
                <div id="production-tidbits-section" class="hidden"></div>

            </div>
        </div>

    </main>

    <div id="info-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title" class="text-2xl font-bold">
                    Episode Details
                </h2>
                <button id="close-modal-btn" class="text-gray-400 hover:text-white transition-colors duration-200 focus:outline-none">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div id="modal-body" class="modal-body window-scroll">
            </div>
        </div>
    </div>

    <script>let episodeData = {}; // Declare episodeData globally

        document.addEventListener('DOMContentLoaded', () => {
            const episodeList = document.getElementById('episode-list');
            const infoTitle = document.getElementById('info-title');
            const initialMessage = document.getElementById('initial-message');
            const infoSynopsisSection = document.getElementById('info-synopsis-section');
            const infoCharactersSection = document.getElementById('info-characters-section');
            const infoLocationsSection = document.getElementById('info-locations-section');
            const infoThumbnailContainer = document.getElementById('info-thumbnail-container');
            const infoThumbnail = document.getElementById('info-thumbnail');
            const episodeLoreSection = document.getElementById('episode-lore-section');
            const easterEggsSection = document.getElementById('easter-eggs-section');
            const productionTidbitsSection = document.getElementById('production-tidbits-section');

            const maximizeBtn = document.getElementById('maximize-btn');
            const infoModal = document.getElementById('info-modal');
            const closeBtn = document.getElementById('close-modal-btn');
            const modalTitle = document.getElementById('modal-title');
            const modalBody = document.getElementById('modal-body');

            const toggleEpisodesBtn = document.getElementById('toggle-episodes-btn');
            const toggleIcon = toggleEpisodesBtn.querySelector('i');

            const isMobile = () => window.innerWidth < 768; // Tailwind's 'md' breakpoint

            // Function to check if an object's properties are all empty or undefined
            const isObjectEmpty = (obj) => {
                if (!obj) return true;
                for (const key in obj) {
                    if (Object.prototype.hasOwnProperty.call(obj, key)) {
                        if (obj[key] !== null && obj[key] !== undefined && obj[key] !== '') {
                            // If the property is an array, check if it has elements
                            if (Array.isArray(obj[key])) {
                                if (obj[key].length > 0) {
                                    return false;
                                }
                            } else if (typeof obj[key] === 'object') {
                                // If it's an object, recursively check if it's empty
                                if (!isObjectEmpty(obj[key])) {
                                    return false;
                                }
                            } else {
                                // For other types, if it's not empty, return false
                                return false;
                            }
                        }
                    }
                }
                return true;
            };


            // Function to update the main info window
            const updateInfoWindow = (episodeId) => {
                const data = episodeData[episodeId];
                if (!data) return;

                infoTitle.textContent = data.title;
                initialMessage.classList.add('hidden');

                if (data.thumbnail) {
                    infoThumbnail.src = data.thumbnail;
                    infoThumbnailContainer.classList.remove('hidden');
                    infoThumbnail.classList.add('thumbnail-style');
                } else {
                    infoThumbnailContainer.classList.add('hidden');
                    infoThumbnail.src = '';
                }

                // Clear previous content
                infoSynopsisSection.innerHTML = '';
                infoCharactersSection.innerHTML = '';
                infoLocationsSection.innerHTML = '';
                episodeLoreSection.innerHTML = '';
                easterEggsSection.innerHTML = '';
                productionTidbitsSection.innerHTML = '';

                // Hide all sections by default and show only if data exists
                infoSynopsisSection.classList.add('hidden');
                infoCharactersSection.classList.add('hidden');
                infoLocationsSection.classList.add('hidden');
                episodeLoreSection.classList.add('hidden');
                easterEggsSection.classList.add('hidden');
                productionTidbitsSection.classList.add('hidden');


                // Synopsis Section
                if (data.synopsis && !isObjectEmpty(data.synopsis)) {
                    infoSynopsisSection.classList.remove('hidden');
                    infoSynopsisSection.innerHTML = `
                            <div class="content-block">
                                <h3 class="section-title">Synopsis (Game Design Analysis)</h3>
                                <ul>
                                    ${data.synopsis.main ? `<li><strong class="text-[#8183f2]"><i class="fa-solid fa-file-alt mr-2"></i>Primary concept/theme:</strong> ${data.synopsis.main}</li>` : ''}
                                    ${data.synopsis.games_analyzed ? `<li><strong class="text-[#8183f2]"><i class="fa-solid fa-gamepad mr-2"></i>Games analyzed and highlighted aspects:</b> ${data.synopsis.games_analyzed}</li>` : ''}
                                    ${data.synopsis.central_argument ? `<li><strong class="text-[#8183f2]"><i class="fa-solid fa-lightbulb mr-2"></i>Central argument/takeaway:</strong> ${data.synopsis.central_argument}</li>` : ''}
                                </ul>
                                <p class="mt-4 text-center">
                                    <a href="${data.url}" target="_blank" class="inline-block bg-transparent border border-indigo-500 text-indigo-highlight py-2 px-4 rounded-md hover:bg-indigo-900 hover:border-indigo-400 transition-colors duration-200">Watch Episode Here ▶️</a>
                                </p>
                            </div>
                        `;
                }

                // Episode Lore Section
                if (data.lore && !isObjectEmpty(data.lore)) {
                    episodeLoreSection.classList.remove('hidden');
                    const loreItems = [
                        data.lore.arc && data.lore.arc.toLowerCase() !== 'no' ? `<li><strong class="text-[#8183f2]"><i class="fa-solid fa-scroll mr-2"></i>Story/narrative arc:</strong> ${data.lore.arc}</li>` : '',
                        data.lore.developments && data.lore.developments.toLowerCase() !== 'no' ? `<li><strong class="text-[#8183f2]"><i class="fa-solid fa-hat-wizard mr-2"></i>Character developments/world-building/motifs:</strong> ${data.lore.developments}</li>` : '',
                        data.lore.meta_commentary && data.lore.meta_commentary.toLowerCase() !== 'no' ? `<li><strong class="text-[#8183f2]"><i class="fa-solid fa-comment-dots mr-2"></i>Meta-commentary on themes/content creation:</strong> ${data.lore.meta_commentary}</li>` : ''
                    ].filter(Boolean).join(''); // Filter out empty strings

                    if (loreItems) {
                        episodeLoreSection.innerHTML = `
                                <div class="content-block">
                                    <h3 class="section-title">Episode Lore/Story (Narrative Elements of the Video Itself)</h3>
                                    <ul>${loreItems}</ul>
                                </div>
                            `;
                    } else {
                        episodeLoreSection.innerHTML = `<div class="content-block"><p class="text-gray-400">No Episode Lore/Story information available for this episode.</p></div>`;
                    }
                }

                // Easter Eggs Section
                if (data.easter_eggs && !isObjectEmpty(data.easter_eggs)) {
                    easterEggsSection.classList.remove('hidden');
                    const easterEggItems = [
                        data.easter_eggs.visual_audio && data.easter_eggs.visual_audio.toLowerCase() !== 'no' ? `<li><strong class="text-[#8183f2]"><i class="fa-solid fa-eye mr-2"></i>Visual or audio Easter eggs:</strong> ${data.easter_eggs.visual_audio}</li>` : '',
                        data.easter_eggs.nods && data.easter_eggs.nods.toLowerCase() !== 'no' ? `<li><strong class="text-[#8183f2]"><i class="fa-solid fa-hand-peace mr-2"></i>Nods to other episodes or meta-references:</strong> ${data.easter_eggs.nods}</li>` : '',
                        data.easter_eggs.inside_jokes && data.easter_eggs.inside_jokes.toLowerCase() !== 'no' ? `<li><strong class="text-[#8183f2]"><i class="fa-solid fa-laugh-squint mr-2"></i>Inside jokes/community references:</strong> ${data.easter_eggs.inside_jokes}</li>` : ''
                    ].filter(Boolean).join('');

                    if (easterEggItems) {
                        easterEggsSection.innerHTML = `
                                <div class="content-block">
                                    <h3 class="section-title">Easter Eggs</h3>
                                    <ul>${easterEggItems}</ul>
                                </div>
                            `;
                    } else {
                        easterEggsSection.innerHTML = `<div class="content-block"><p class="text-gray-400">No Easter Eggs information available for this episode.</p></div>`;
                    }
                }

                // Production Tidbits Section
                if (data.production_tidbits && (!isObjectEmpty(data.production_tidbits) || (data.recording_facts && data.recording_facts.toLowerCase() !== 'no'))) {
                    productionTidbitsSection.classList.remove('hidden');
                    let productionTidbitsHtml = `
                            <div class="content-block">
                                <h3 class="section-title">Production Tidbits</h3>
                                <ul>
                                    ${data.production_tidbits.challenges ? `<li><strong class="text-[#8183f2]"><i class="fa-solid fa-cogs mr-2"></i>Challenges or interesting aspects in production:</strong> ${data.production_tidbits.challenges}</li>` : ''}
                                    ${data.production_tidbits.alternative_ideas ? `<li><strong class="text-[#8183f2]"><i class="fa-solid fa-lightbulb-on mr-2"></i>Alternative ideas or unused concepts:</strong> ${data.production_tidbits.alternative_ideas}</li>` : ''}
                                    ${data.recording_facts && data.recording_facts.toLowerCase() !== 'no' ? `<li><strong class="text-[#8183f2]"><i class="fa-solid fa-microphone-alt mr-2"></i>Recording/script/asset creation facts:</strong> ${data.recording_facts}</li>` : ''}
                                </ul>
                            </div>
                        `;
                    productionTidbitsSection.innerHTML = productionTidbitsHtml;
                } else if (data.production_tidbits && isObjectEmpty(data.production_tidbits) && (!data.recording_facts || data.recording_facts.toLowerCase() === 'no')) {
                    // Only show "No info" if both production_tidbits object and recording_facts are empty/no
                    productionTidbitsSection.classList.remove('hidden');
                    productionTidbitsSection.innerHTML = `<div class="content-block"><p class="text-gray-400">No Production Tidbits information available for this episode.</p></div>`;
                }

                // Character Section
                if (data.characters && data.characters.length > 0) {
                    infoCharactersSection.classList.remove('hidden');
                    infoCharactersSection.innerHTML = `
                            <div class="content-block">
                                <h3 class="section-title">Key Characters</h3>
                                <ul>${data.characters.map(character => `<li><i class="fa-solid fa-users mr-2"></i>${character}</li>`).join('')}</ul>
                            </div>
                        `;
                } else {
                    infoCharactersSection.classList.add('hidden'); // Ensure hidden if no characters
                }

                // Locations Section
                if (data.locations && data.locations.length > 0) {
                    infoLocationsSection.classList.remove('hidden');
                    infoLocationsSection.innerHTML = `
                            <div class="content-block">
                                <h3 class="section-title">Key Locations</h3>
                                <ul>${data.locations.map(location => `<li><i class="fa-solid fa-map-marker-alt mr-2"></i>${location}</li>`).join('')}</ul>
                            </div>
                        `;
                } else {
                    infoLocationsSection.classList.add('hidden'); // Ensure hidden if no locations
                }
            };

            const openModal = () => {
                const currentSelected = document.querySelector('.episode-item.selected');
                const currentEpisodeId = currentSelected ? currentSelected.dataset.episode : Object.keys(episodeData)[0]; // Fallback to first episode if none selected
                const data = episodeData[currentEpisodeId];

                if (!data) return;

                modalTitle.textContent = data.title;
                let modalContentHtml = '';

                if (data.thumbnail) {
                    modalContentHtml += `<div class="text-center mb-4">
                                                                <img src="${data.thumbnail}" alt="Episode Thumbnail" class="thumbnail-style">
                                                            </div>`;
                }

                // Synopsis Section for Modal
                if (data.synopsis && !isObjectEmpty(data.synopsis)) {
                    modalContentHtml += `
                            <div class="content-block">
                                <h3 class="section-title">Synopsis (Game Design Analysis)</h3>
                                <ul>
                                    ${data.synopsis.main ? `<li><strong class="text-[#8183f2]"><i class="fa-solid fa-file-alt mr-2"></i>Primary concept/theme:</strong> ${data.synopsis.main}</li>` : ''}
                                    ${data.synopsis.games_analyzed ? `<li><strong class="text-[#8183f2]"><i class="fa-solid fa-gamepad mr-2"></i>Games analyzed and highlighted aspects:</strong> ${data.synopsis.games_analyzed}</li>` : ''}
                                    ${data.synopsis.central_argument ? `<li><strong class="text-[#8183f2]"><i class="fa-solid fa-lightbulb mr-2"></i>Central argument/takeaway:</strong> ${data.synopsis.central_argument}</li>` : ''}
                                </ul>
                                <p class="mt-4 text-center">
                                    <a href="${data.url}" target="_blank" class="inline-block bg-transparent border border-indigo-500 text-indigo-highlight py-2 px-4 rounded-md hover:bg-indigo-900 hover:border-indigo-400 transition-colors duration-200">Watch Episode Here ▶️</a>
                                </p>
                            </div>
                        `;
                }

                // Episode Lore Section for Modal
                if (data.lore && !isObjectEmpty(data.lore)) {
                    const loreItems = [
                        data.lore.arc && data.lore.arc.toLowerCase() !== 'no' ? `<li><strong class="text-[#8183f2]"><i class="fa-solid fa-scroll mr-2"></i>Story/narrative arc:</strong> ${data.lore.arc}</li>` : '',
                        data.lore.developments && data.lore.developments.toLowerCase() !== 'no' ? `<li><strong class="text-[#8183f2]"><i class="fa-solid fa-hat-wizard mr-2"></i>Character developments/world-building/motifs:</strong> ${data.lore.developments}</li>` : '',
                        data.lore.meta_commentary && data.lore.meta_commentary.toLowerCase() !== 'no' ? `<li><strong class="text-[#8183f2]"><i class="fa-solid fa-comment-dots mr-2"></i>Meta-commentary on themes/content creation:</strong> ${data.lore.meta_commentary}</li>` : ''
                    ].filter(Boolean).join('');

                    if (loreItems) {
                        modalContentHtml += `
                                <div class="content-block">
                                    <h3 class="section-title">Episode Lore/Story (Narrative Elements of the Video Itself)</h3>
                                    <ul>${loreItems}</ul>
                                </div>
                            `;
                    } else {
                        modalContentHtml += `<div class="content-block"><p class="text-gray-400">No Episode Lore/Story information available for this episode.</p></div>`;
                    }
                } else {
                    modalContentHtml += `<div class="content-block"><p class="text-gray-400">No Episode Lore/Story information available for this episode.</p></div>`;
                }

                // Easter Eggs Section for Modal
                if (data.easter_eggs && !isObjectEmpty(data.easter_eggs)) {
                    const easterEggItems = [
                        data.easter_eggs.visual_audio && data.easter_eggs.visual_audio.toLowerCase() !== 'no' ? `<li><strong class="text-[#8183f2]"><i class="fa-solid fa-eye mr-2"></i>Visual or audio Easter eggs:</strong> ${data.easter_eggs.visual_audio}</li>` : '',
                        data.easter_eggs.nods && data.easter_eggs.nods.toLowerCase() !== 'no' ? `<li><strong class="text-[#8183f2]"><i class="fa-solid fa-hand-peace mr-2"></i>Nods to other episodes or meta-references:</strong> ${data.easter_eggs.nods}</li>` : '',
                        data.easter_eggs.inside_jokes && data.easter_eggs.inside_jokes.toLowerCase() !== 'no' ? `<li><strong class="text-[#8183f2]"><i class="fa-solid fa-laugh-squint mr-2"></i>Inside jokes/community references:</strong> ${data.easter_eggs.inside_jokes}</li>` : ''
                    ].filter(Boolean).join('');

                    if (easterEggItems) {
                        modalContentHtml += `
                                <div class="content-block">
                                    <h3 class="section-title">Easter Eggs</h3>
                                    <ul>${easterEggItems}</ul>
                                </div>
                            `;
                    } else {
                        modalContentHtml += `<div class="content-block"><p class="text-gray-400">No Easter Eggs information available for this episode.</p></div>`;
                    }
                } else {
                    modalContentHtml += `<div class="content-block"><p class="text-gray-400">No Easter Eggs information available for this episode.</p></div>`;
                }

                // Production Tidbits Section for Modal
                if (data.production_tidbits && (!isObjectEmpty(data.production_tidbits) || (data.recording_facts && data.recording_facts.toLowerCase() !== 'no'))) {
                    const prodTidbitItems = [
                        data.production_tidbits.challenges ? `<li><strong class="text-[#8183f2]"><i class="fa-solid fa-cogs mr-2"></i>Challenges or interesting aspects in production:</strong> ${data.production_tidbits.challenges}</li>` : '',
                        data.production_tidbits.alternative_ideas ? `<li><strong class="text-[#8183f2]"><i class="fa-solid fa-lightbulb-on mr-2"></i>Alternative ideas or unused concepts:</strong> ${data.production_tidbits.alternative_ideas}</li>` : '',
                        data.recording_facts && data.recording_facts.toLowerCase() !== 'no' ? `<li><strong class="text-[#8183f2]"><i class="fa-solid fa-microphone-alt mr-2"></i>Recording/script/asset creation facts:</strong> ${data.recording_facts}</li>` : ''
                    ].filter(Boolean).join('');

                    if (prodTidbitItems) {
                        modalContentHtml += `
                                <div class="content-block">
                                    <h3 class="section-title">Production Tidbits</h3>
                                    <ul>${prodTidbitItems}</ul>
                                </div>
                            `;
                    } else {
                        modalContentHtml += `<div class="content-block"><p class="text-gray-400">No Production Tidbits information available for this episode.</p></div>`;
                    }

                } else {
                    modalContentHtml += `<div class="content-block"><p class="text-gray-400">No Production Tidbits information available for this episode.</p></div>`;
                }

                // Characters Section for Modal
                if (data.characters && data.characters.length > 0) {
                    modalContentHtml += `
                            <div class="content-block">
                                <h3 class="section-title">Key Characters</h3>
                                <ul>
                                    ${data.characters.map(character => `<li><i class="fa-solid fa-users mr-2"></i>${character}</li>`).join('')}
                                </ul>
                            </div>
                        `;
                } else {
                    modalContentHtml += `<div class="content-block"><p class="text-gray-400">No Key Characters information available for this episode.</p></div>`;
                }

                // Locations Section for Modal
                if (data.locations && data.locations.length > 0) {
                    modalContentHtml += `
                            <div class="content-block">
                                <h3 class="section-title">Key Locations</h3>
                                <ul>
                                    ${data.locations.map(location => `<li><i class="fa-solid fa-map-marker-alt mr-2"></i>${location}</li>`).join('')}
                                </ul>
                            </div>
                        `;
                } else {
                    modalContentHtml += `<div class="content-block"><p class="text-gray-400">No Key Locations information available for this episode.</p></div>`;
                }

                modalBody.innerHTML = modalContentHtml;
                infoModal.style.display = 'flex';
            };

            const closeModal = () => {
                infoModal.style.display = 'none';
            };

            // Toggle episode list visibility on small screens
            const toggleEpisodeList = () => {
                episodeList.classList.toggle('expanded');
                // The 'hidden' class which sets display:none should be removed/added along with 'expanded'
                // to allow transitions to work correctly.
                if (episodeList.classList.contains('expanded')) {
                    episodeList.classList.remove('hidden');
                    toggleIcon.classList.replace('fa-chevron-down', 'fa-chevron-up');
                } else {
                    // Give it a moment to finish collapse animation before setting display:none
                    setTimeout(() => {
                        episodeList.classList.add('hidden');
                    }, 300); // Match transition duration
                    toggleIcon.classList.replace('fa-chevron-up', 'fa-chevron-down');
                }
            };

            // Handle initial state and window resizing for episode list
            const handleResize = () => {
                if (isMobile()) {
                    episodeList.classList.add('hidden'); // Ensure it's hidden by default on mobile
                    episodeList.classList.remove('expanded'); // Ensure not expanded initially
                    toggleIcon.classList.replace('fa-chevron-up', 'fa-chevron-down'); // Ensure icon is 'down'
                    toggleEpisodesBtn.classList.remove('hidden'); // Show toggle button
                } else {
                    episodeList.classList.remove('hidden'); // Always visible on larger screens
                    episodeList.classList.add('expanded'); // Always expanded on larger screens
                    toggleIcon.classList.replace('fa-chevron-down', 'fa-chevron-up'); // Ensure icon is 'up'
                    toggleEpisodesBtn.classList.add('hidden'); // Hide toggle button
                }
            };


            // Dynamically populate episode list
            const populateEpisodeList = () => {
                episodeList.innerHTML = ''; // Clear existing list items
                for (const episodeId in episodeData) {
                    const data = episodeData[episodeId];
                    const listItem = document.createElement('li');
                    listItem.classList.add('episode-item', 'cursor-pointer', 'p-3', 'rounded-lg', 'hover:bg-indigo-600', 'hover:text-white', 'transition-colors', 'duration-200', 'mb-2');
                    listItem.dataset.episode = episodeId;

                    // Extract season and episode from the title using the updated regex
                    const fullTitle = data.title;
                    let seasonEpisodePrefix = '';
                    let actualTitle = fullTitle;

                    const match = fullTitle.match(/(Season \d+, Episode \d+): (.+)/);
                    if (match) {
                        seasonEpisodePrefix = match[1];
                        actualTitle = match[2];
                    }

                    listItem.innerHTML = `
                                <div class="text-xs text-gray-400 mb-1">${seasonEpisodePrefix}</div>
                                <h3 class="font-semibold">${actualTitle}</h3>
                                <p class="text-sm text-gray-400 hover:text-white">${data.snippet}</p>
                            `;
                    episodeList.appendChild(listItem);
                }
            };

            episodeList.addEventListener('click', (event) => {
                const item = event.target.closest('.episode-item');
                if (!item) return;

                const currentSelected = document.querySelector('.episode-item.selected');
                if (currentSelected) {
                    currentSelected.classList.remove('selected');
                }
                item.classList.add('selected');

                const episodeId = item.dataset.episode;
                updateInfoWindow(episodeId);

                // Auto-collapse episode list on mobile after selection
                if (isMobile()) {
                    // Give it a moment to finish collapse animation before setting display:none
                    setTimeout(() => {
                        episodeList.classList.add('hidden');
                    }, 300); // Match transition duration
                    episodeList.classList.remove('expanded');
                    toggleIcon.classList.replace('fa-chevron-up', 'fa-chevron-down');
                }
            });

            maximizeBtn.addEventListener('click', openModal);
            closeBtn.addEventListener('click', closeModal);
            toggleEpisodesBtn.addEventListener('click', toggleEpisodeList);

            // Add event listener for window resize to handle responsiveness
            window.addEventListener('resize', handleResize);


            // Fetch JSON data and then initialize the page
            fetch('goc_lore.json') // Assuming goc_lore.json is in the same directory
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    // Transform the array into an object with episode IDs as keys
                    episodeData = data.reduce((acc, item) => {
                        // Extract season and episode numbers from episodeTitle
                        const match = item.episodeTitle.match(/Season (\d+), Episode (\d+):/);
                        if (match) {
                            const seasonNum = parseInt(match[1]);
                            const episodeNum = parseInt(match[2]);
                            const episodeId = `s${seasonNum}e${episodeNum}`;

                            acc[episodeId] = {
                                title: item.episodeTitle,
                                snippet: item.synopsisQuestions["What is the primary game design concept or theme discussed in this episode?"],
                                url: item.youtubeUrl,
                                thumbnail: item.thumbnail,
                                synopsis: {
                                    main: item.synopsisQuestions["What is the primary game design concept or theme discussed in this episode?"],
                                    games_analyzed: item.synopsisQuestions["What specific games are analyzed, and what aspects of their design are highlighted in relation to the main concept?"],
                                    central_argument: item.synopsisQuestions["What is the central argument or key takeaway the episode makes about game design?"]
                                },
                                lore: {
                                    arc: item.episodeLoreQuestions["Does this episode have a specific 'story' or narrative arc beyond just the game design analysis?"],
                                    developments: item.episodeLoreQuestions["If applicable, are there any specific character developments, world-building elements, or recurring motifs introduced or expanded upon in this episode?"],
                                    meta_commentary: item.episodeLoreQuestions["Does the video's own narrative offer any meta-commentary on the themes of the series or the act of creating content?"]
                                },
                                easter_eggs: {
                                    visual_audio: item.easterEggsQuestions["Are there any specific visual or audio Easter eggs in this episode (e.g., hidden references in the background, specific props, subtle audio cues)?"],
                                    nods: item.easterEggsQuestions["Are there any subtle nods to previous episodes, future content, or meta-references within the series itself?"],
                                    inside_jokes: item.easterEggsQuestions["Are there any inside jokes or community references integrated into this episode?"]
                                },
                                production_tidbits: {
                                    challenges: item.productionTidbitsQuestions["What was a notable challenge or interesting aspect during the production of this episode (e.g., research difficulty, specific editing techniques, unexpected discoveries during analysis)?"],
                                    alternative_ideas: item.productionTidbitsQuestions["Were there any alternative ideas or unused concepts for this episode that were considered and then discarded?"]
                                },
                                recording_facts: item.productionTidbitsQuestions["Any interesting facts about the recording process, script writing, or asset creation for this particular video?"],
                                characters: item.episodeCharacters || [], // Ensure it's an array, default to empty
                                locations: item.episodeLocations || []    // Ensure it's an array, default to empty
                            };
                        }
                        return acc;
                    }, {});

                    populateEpisodeList();
                    handleResize(); // Call handleResize on initial load

                    // Select the first episode by default
                    const firstEpisode = document.querySelector('.episode-item');
                    if (firstEpisode) {
                        firstEpisode.classList.add('selected');
                        updateInfoWindow(firstEpisode.dataset.episode);
                    } else {
                        initialMessage.classList.remove('hidden');
                    }
                })
                .catch(error => {
                    console.error('Error fetching episode data:', error);
                    initialMessage.textContent = 'Failed to load episode data. Please try again later.';
                    initialMessage.classList.remove('hidden');
                });
        });</script>
</body>
</html>