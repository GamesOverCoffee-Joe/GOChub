<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Games Over Coffee Lore</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Poppins:wght@700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" xintegrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* Custom scroll behavior for smoother jumps */
        html {
            scroll-behavior: smooth;
        }

        /* Set a custom dark theme using CSS variables */
        :root {
            --color-goc-darkest: #1f1f1f;
            --color-goc-dark: #2b2b2b;
            --color-goc-light-accent: #aac6ce;
            --color-goc-main-text: #ead9ca;
            --gradient-goc-indigo: linear-gradient(to right, #6366f1, #8b5cf6);
            --color-goc-desaturated-indigo: #4a4d7c;
            --color-goc-light-indigo-hover: #3c3f6b;
            --color-border-subtle: #3A4452;
            --color-card-border: #303A45;
            --color-hover-bg: #35424D;
            --color-scrollbar-thumb: #50687E;
            --color-highlight-bg: #3e2f4a;
            --color-highlight-text: #e0ccff;
            /* New custom colors for sections */
            --color-synopsis-bg: #222a30; /* Slightly different dark */
            --color-synopsis-border: #28303a;
            --color-synopsis-heading: #7cb9e4; /* A soft blue */
            --color-synopsis-text: #9aa7b3; /* Understated gray */

            --color-lore-bg: #2a2230; /* Slightly different dark */
            --color-lore-border: #342b3d;
            --color-lore-heading: #c47ce4; /* A soft purple */
            --color-lore-bullet: #c47ce4; /* Matching bullet color */

            --color-easter-eggs-bg: #302222; /* Slightly different dark */
            --color-easter-eggs-border: #3a2b2b;
            --color-easter-eggs-heading: #e47c7c; /* A soft red */
            --color-easter-eggs-bullet: #e47c7c; /* Matching bullet color */

            --color-production-bg: #22302a; /* Slightly different dark */
            --color-production-border: #2b3a34;
            --color-production-heading: #7ce499; /* A soft green */
            --color-production-bullet: #7ce499; /* Matching bullet color */
        }

        /* Custom styles to enhance the theme and readability */
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--color-goc-darkest);
            color: #d1d5db;
            min-height: 100vh;
        }

        h1 {
            color: white;
        }

        h2 {
            color: #8183f2;
        }

        h3 {
            color: #b1b9c4;
        }

        .text-glow {
            text-shadow: 0 0 8px rgba(99, 102, 241, 0.5);
        }

        .bg-window {
            background-color: var(--color-goc-dark);
            border: 1px solid #3c3c3c;
        }

        .text-indigo-highlight {
            color: #6366f1;
        }

        .window-scroll {
            scrollbar-width: thin;
            scrollbar-color: var(--color-scrollbar-thumb) var(--color-goc-dark);
        }

            .window-scroll::-webkit-scrollbar {
                width: 8px;
            }

            .window-scroll::-webkit-scrollbar-track {
                background: var(--color-goc-dark);
            }

            .window-scroll::-webkit-scrollbar-thumb {
                background-color: var(--color-scrollbar-thumb);
                border-radius: 20px;
                border: 2px solid var(--color-goc-dark);
            }

        /* Modal specific styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background-color: var(--color-goc-dark);
            padding: 1.5rem;
            border-radius: 1rem;
            width: 95%;
            max-width: 800px;
            height: 90%;
            display: flex;
            flex-direction: column;
            border: 1px solid #3c3c3c;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 1rem;
            border-bottom: 1px solid #3c3c3c;
            margin-bottom: 1rem;
        }

        .modal-body {
            flex-grow: 1;
            overflow-y: auto;
            padding-right: 1rem;
        }

        /* Revert section-title to common styling and use inline style for specific colors */
        .section-title {
            font-weight: bold;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--color-border-subtle);
            font-size: 1.25rem;
        }

        .content-block {
            background-color: var(--color-goc-darkest);
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            border: 1px solid var(--color-card-border);
        }

            .content-block ul {
                list-style: none;
                padding-left: 0;
            }

                .content-block ul li {
                    margin-bottom: 0.5rem;
                    padding-left: 1.5rem;
                    position: relative;
                }

                    /* Specific bullet colors for each content block */
                    .content-block ul li::before {
                        content: "•";
                        position: absolute;
                        left: 0;
                    }

        #info-synopsis-section .content-block ul li::before,
        #modal-body .content-block:has(.text-\[var\(--color-synopsis-heading\)\]) ul li::before {
            color: var(--color-synopsis-heading); /* Synopsis bullets match heading */
        }

        #episode-lore-section .content-block ul li::before,
        #modal-body .content-block:has(.text-\[var\(--color-lore-heading\)\]) ul li::before {
            color: var(--color-lore-bullet); /* Lore bullets match heading */
        }

        #easter-eggs-section .content-block ul li::before,
        #modal-body .content-block:has(.text-\[var\(--color-easter-eggs-heading\)\]) ul li::before {
            color: var(--color-easter-eggs-bullet); /* Easter Eggs bullets match heading */
        }

        #production-tidbits-section .content-block ul li::before,
        #modal-body .content-block:has(.text-\[var\(--color-production-heading\)\]) ul li::before {
            color: var(--color-production-bullet); /* Production Tidbits bullets match heading */
        }

        .thumbnail-style {
            max-width: 70%;
            height: auto;
            display: block;
            margin: 1rem auto;
            border-radius: 0.75rem;
            box-shadow: 0 0 15px rgba(99, 102, 241, 0.3);
        }

        /* Compact Version Specific Styles */
        .episode-item {
            display: flex;
            align-items: center;
            border: 1px solid var(--color-card-border);
            border-radius: 0.75rem;
            background-color: var(--color-goc-darkest);
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }

            .episode-item:hover {
                transform: translateY(-2px);
                box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
                background-color: var(--color-hover-bg);
            }

            .episode-item.selected {
                background-color: var(--color-hover-bg);
                border-color: #6366f1;
            }

        .episode-number-badge {
            flex-shrink: 0;
            width: 4rem; /* Fixed width for the badge */
            height: 100%;
            background-color: #2e3048; /* Darker, slightly desaturated indigo */
            border-top-left-radius: 0.75rem;
            border-bottom-left-radius: 0.75rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            padding: 0.5rem 0;
        }

            .episode-number-badge.selected {
                background-color: #6366f1; /* Bright indigo when selected */
            }

        .episode-details {
            flex-grow: 1;
            padding: 0.75rem 1rem;
            min-width: 0;
        }

            .episode-details h3 {
                font-size: 1.1rem;
                font-weight: 700;
                color: #d1d5db;
                overflow: hidden;
                white-space: nowrap;
                text-overflow: ellipsis;
            }

            .episode-details p {
                font-size: 0.8rem;
                color: #9ca3af;
                overflow: hidden;
                text-overflow: ellipsis;
                display: -webkit-box;
                -webkit-line-clamp: 2;
                -webkit-box-orient: vertical;
            }

        /* Responsive adjustments for episode list */
        @media (max-width: 768px) {
            .main {
                flex-direction: column;
                overflow-y: auto;
            }

            #episode-list-window {
                width: 100%;
                margin-right: 0;
                margin-bottom: 1rem;
                flex-shrink: 0;
            }

                #episode-list-window h2 {
                    font-size: 1.5rem;
                    margin-bottom: 0.5rem;
                    padding-bottom: 0.5rem;
                }

            #episode-list {
                flex-direction: row;
                overflow-x: auto;
                overflow-y: hidden;
                -webkit-overflow-scrolling: touch;
                max-height: 0;
                opacity: 0;
                visibility: hidden;
                padding-bottom: 0;
                padding-top: 0;
                transition: max-height 0.3s ease-out, opacity 0.3s ease-out, padding 0.3s ease-out, visibility 0.3s ease-out;
            }

                #episode-list.expanded {
                    display: flex;
                    max-height: 120px;
                    opacity: 1;
                    visibility: visible;
                    padding-bottom: 10px;
                    padding-top: 0.5rem;
                }

            .episode-item {
                flex: 0 0 auto;
                width: 300px;
                margin-right: 1rem;
                margin-bottom: 0;
                white-space: normal;
                border: 1px solid #3c3c3c;
            }

            .episode-details h3 {
                font-size: 1rem;
            }

            .episode-details p {
                font-size: 0.75rem;
            }

            #info-window {
                width: 100%;
                flex-grow: 1;
            }

                #info-window #info-title {
                    font-size: 1.5rem;
                    padding-right: 10px;
                }

            #maximize-btn {
                padding: 0.5rem;
            }
        }
    </style>
</head>
<body class="flex flex-col h-screen">

    <header class="fixed top-0 left-0 w-full bg-[var(--color-goc-darkest)] shadow-lg z-40">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-4">
                <a href="index.html" class="flex items-center space-x-2">
                    <img src="../images/GOClogo.png" alt="Games Over Coffee Logo" class="h-10 w-10">
                    <span class="text-2xl font-extrabold font-poppins text-[var(--color-goc-light-accent)] hidden sm:block">Games Over Coffee - Lore</span>
                </a>
            </div>
            <nav class="flex flex-wrap justify-center sm:justify-end gap-x-4 gap-y-2 text-sm md:text-base">
                <a href="../index.html" class="text-[var(--color-goc-main-text)] hover:text-[var(--color-goc-light-accent)] transition-colors duration-300 relative group">
                    Home
                    <span class="absolute left-0 bottom-0 w-full h-0.5 bg-[var(--color-goc-light-accent)] origin-left transform scale-x-0 transition-transform duration-300 group-hover:scale-x-100"></span>
                </a>
                <a href="../consulting_site/consulting_site.html" class="text-[var(--color-goc-main-text)] hover:text-[var(--color-goc-light-accent)] transition-colors duration-300 relative group">
                    Consulting
                    <span class="absolute left-0 bottom-0 w-full h-0.5 bg-[var(--color-goc-light-accent)] origin-left transform scale-x-0 transition-transform duration-300 group-hover:scale-x-100"></span>
                </a>
                <a href="../lore_site/GOClore.html" class="text-[var(--color-goc-main-text)] hover:text-[var(--color-goc-light-accent)] transition-colors duration-300 relative group">
                    Lore
                    <span class="absolute left-0 bottom-0 w-full h-0.5 bg-[var(--color-goc-light-accent)] origin-left transform scale-x-0 transition-transform duration-300 group-hover:scale-x-100"></span>
                </a>
                <a href="https://www.youtube.com/@GamesOverCoffee" target="_blank" class="text-[var(--color-goc-main-text)] hover:text-[var(--color-goc-light-accent)] transition-colors duration-300 relative group hidden md:flex items-center space-x-1">
                    <i class="fab fa-youtube text-red-500 text-lg"></i>
                    <span>YouTube</span>
                    <span class="absolute left-0 bottom-0 w-full h-0.5 bg-[var(--color-goc-light-accent)] origin-left transform scale-x-0 transition-transform duration-300 group-hover:scale-x-100"></span>
                </a>
                <a href="https://www.youtube.com/@GamesOverCoffeeConsulting" target="_blank" class="text-[var(--color-goc-main-text)] hover:text-[var(--color-goc-light-accent)] transition-colors duration-300 relative group hidden md:flex items-center space-x-1">
                    <i class="fab fa-youtube text-red-500 text-lg"></i>
                    <span>Consulting YT</span>
                    <span class="absolute left-0 bottom-0 w-full h-0.5 bg-[var(--color-goc-light-accent)] origin-left transform scale-x-0 transition-transform duration-300 group-hover:scale-x-100"></span>
                </a>
            </nav>
        </div>
    </header>

    <main class="flex-grow flex flex-col md:flex-row p-4 md:p-8 mt-10 overflow-hidden container mx-auto">

        <div id="episode-list-window" class="md:w-1/3 lg:w-1/4 bg-window rounded-xl shadow-lg p-4 md:p-6 mb-4 md:mb-0 md:mr-4 flex flex-col overflow-hidden">
            <div class="flex justify-between items-center mb-4 border-b border-gray-600 pb-2">
                <h2 class="text-xl md:text-2xl font-bold">Episodes</h2>
                <button id="toggle-episodes-btn" class="md:hidden text-indigo-400 hover:text-white transition-colors duration-200">
                    <i class="fa-solid fa-chevron-down text-lg"></i>
                </button>
            </div>

            <ul id="episode-list" class="flex-grow overflow-y-auto window-scroll hidden md:flex-grow flex flex-col gap-2">
            </ul>
        </div>

        <div id="info-window" class="md:w-2/3 lg:w-3/4 bg-window rounded-xl shadow-lg p-4 md:p-6 flex flex-col overflow-hidden relative">
            <div class="flex justify-between items-start mb-4 border-b border-gray-600 pb-2 pt-1">
                <h2 id="info-title" class="text-xl md:text-2xl font-bold pr-28">
                    Select an Episode
                </h2>
                <button id="maximize-btn" class="absolute top-4 right-4 bg-transparent text-indigo-400 border border-indigo-500 py-2 px-3 rounded-md hover:bg-indigo-900 hover:border-indigo-400 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 flex items-center justify-center">
                    <i class="fa-solid fa-expand w-4 h-4"></i>
                </button>
            </div>

            <div id="info-content" class="flex-grow overflow-y-auto window-scroll">
                <p id="initial-message" class="text-gray-400 leading-relaxed mb-4">
                    Choose an episode from the list to reveal its full lore, character biographies, and key plot points.
                </p>

                <div id="info-thumbnail-container" class="hidden">
                    <img id="info-thumbnail" src="" alt="Episode Thumbnail" class="thumbnail-style">
                </div>

                <div id="info-synopsis-section"></div>
                <div id="info-characters-section"></div>
                <div id="info-locations-section"></div>
                <div id="episode-lore-section" class="hidden"></div>
                <div id="easter-eggs-section" class="hidden"></div>
                <div id="production-tidbits-section" class="hidden"></div>

            </div>
        </div>

    </main>

    <div id="info-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title" class="text-2xl font-bold">
                    Episode Details
                </h2>
                <button id="close-modal-btn" class="text-gray-400 hover:text-white transition-colors duration-200 focus:outline-none">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div id="modal-body" class="modal-body window-scroll">
            </div>
        </div>
    </div>

    <script>
        let episodeData = {}; // Declare episodeData globally

        document.addEventListener('DOMContentLoaded', () => {
            const episodeList = document.getElementById('episode-list');
            const infoTitle = document.getElementById('info-title');
            const initialMessage = document.getElementById('initial-message');
            const infoSynopsisSection = document.getElementById('info-synopsis-section');
            const infoCharactersSection = document.getElementById('info-characters-section');
            const infoLocationsSection = document.getElementById('info-locations-section');
            const infoThumbnailContainer = document.getElementById('info-thumbnail-container');
            const infoThumbnail = document.getElementById('info-thumbnail');
            const episodeLoreSection = document.getElementById('episode-lore-section');
            const easterEggsSection = document.getElementById('easter-eggs-section');
            const productionTidbitsSection = document.getElementById('production-tidbits-section');

            const maximizeBtn = document.getElementById('maximize-btn');
            const infoModal = document.getElementById('info-modal');
            const closeBtn = document.getElementById('close-modal-btn');
            const modalTitle = document.getElementById('modal-title');
            const modalBody = document.getElementById('modal-body');

            const toggleEpisodesBtn = document.getElementById('toggle-episodes-btn');
            const toggleIcon = toggleEpisodesBtn.querySelector('i');

            const isMobile = () => window.innerWidth < 768; // Tailwind's 'md' breakpoint

            // Function to check if an object's properties are all empty or undefined
            const isObjectEmpty = (obj) => {
                if (!obj) return true;
                for (const key in obj) {
                    if (Object.prototype.hasOwnProperty.call(obj, key)) {
                        if (obj[key] !== null && obj[key] !== undefined && obj[key] !== '') {
                            // If the property is an array, check if it has elements
                            if (Array.isArray(obj[key])) {
                                if (obj[key].length > 0) {
                                    return false;
                                }
                            } else if (typeof obj[key] === 'object') {
                                // If it's an object, recursively check if it's empty
                                if (!isObjectEmpty(obj[key])) {
                                    return false;
                                }
                            } else {
                                // For other types, if it's not empty, return false
                                return false;
                            }
                        }
                    }
                }
                return true;
            };

            // Helper function to format text with line breaks into a bulleted list
            const formatTextAsList = (text) => {
                if (!text) return '';
                const items = text.split('\\n').filter(line => line.trim() !== '');
                if (items.length === 0) return '';

                let listHtml = '<ul>';
                items.forEach(item => {
                    listHtml += `<li>${item.trim()}</li>`;
                });
                listHtml += '</ul>';
                return listHtml;
            };

            // Function to update the main info window
            const updateInfoWindow = (episodeId) => {
                const data = episodeData[episodeId];
                if (!data) return;

                infoTitle.textContent = data.title;
                initialMessage.classList.add('hidden');

                if (data.thumbnail) {
                    infoThumbnail.src = data.thumbnail;
                    infoThumbnailContainer.classList.remove('hidden');
                    infoThumbnail.classList.add('thumbnail-style');
                } else {
                    infoThumbnailContainer.classList.add('hidden');
                    infoThumbnail.src = '';
                }

                // Clear previous content
                infoSynopsisSection.innerHTML = '';
                infoCharactersSection.innerHTML = '';
                infoLocationsSection.innerHTML = '';
                episodeLoreSection.innerHTML = '';
                easterEggsSection.innerHTML = '';
                productionTidbitsSection.innerHTML = '';

                // Hide all sections by default and show only if data exists
                infoSynopsisSection.classList.add('hidden');
                infoCharactersSection.classList.add('hidden');
                infoLocationsSection.classList.add('hidden');
                episodeLoreSection.classList.add('hidden');
                easterEggsSection.classList.add('hidden');
                productionTidbitsSection.classList.add('hidden');


                // Synopsis Section
                if (data.synopsis && !isObjectEmpty(data.synopsis)) {
                    infoSynopsisSection.classList.remove('hidden');
                    infoSynopsisSection.innerHTML = `
                                        <div class="content-block bg-[var(--color-synopsis-bg)] border-[var(--color-synopsis-border)]">
                                            <h3 class="section-title text-[var(--color-synopsis-heading)]">Game Design Topics Covered 🎮</h3>
                                            <div class="text-sm text-[var(--color-synopsis-text)]">${formatTextAsList(Object.values(data.synopsis).join('\\n'))}</div>
                                            <p class="mt-4 text-center">
                                                <a href="${data.url}" target="_blank" class="inline-block bg-transparent border border-indigo-500 text-indigo-highlight py-2 px-4 rounded-md hover:bg-indigo-900 hover:border-indigo-400 transition-colors duration-200">Watch Episode Here 📺</a>
                                            </p>
                                        </div>
                                    `;
                }

                // Episode Lore Section
                if (data.lore && !isObjectEmpty(data.lore)) {
                    episodeLoreSection.classList.remove('hidden');
                    episodeLoreSection.innerHTML = `
                                        <div class="content-block bg-[var(--color-lore-bg)] border-[var(--color-lore-border)]">
                                            <h3 class="section-title text-[var(--color-lore-heading)]">Episode Lore/Story 📖</h3>
                                            <div class="text-sm text-[var(--color-lore-text)]">${formatTextAsList(Object.values(data.lore).join('\\n'))}</div>
                                        </div>
                                    `;
                }

                // Easter Eggs Section
                if (data.easter_eggs && !isObjectEmpty(data.easter_eggs)) {
                    easterEggsSection.classList.remove('hidden');
                    easterEggsSection.innerHTML = `
                                        <div class="content-block bg-[var(--color-easter-eggs-bg)] border-[var(--color-easter-eggs-border)]">
                                            <h3 class="section-title text-[var(--color-easter-eggs-heading)]">Easter Eggs 🥚</h3>
                                            <div class="text-sm text-[var(--color-easter-eggs-text)]">${formatTextAsList(Object.values(data.easter_eggs).join('\\n'))}</div>
                                        </div>
                                    `;
                }

                // Production Tidbits Section
                const hasProductionData = data.production_tidbits && !isObjectEmpty(data.production_tidbits);
                const hasRecordingFacts = data.recording_facts && data.recording_facts.toLowerCase() !== 'no';
                
                if (hasProductionData || hasRecordingFacts) {
                    productionTidbitsSection.classList.remove('hidden');
                    const allProdTidbits = [
                        data.production_tidbits.challenges,
                        data.production_tidbits.alternative_ideas,
                        data.recording_facts
                    ].filter(Boolean).join('\\n');

                    productionTidbitsSection.innerHTML = `
                                        <div class="content-block bg-[var(--color-production-bg)] border-[var(--color-production-border)]">
                                            <h3 class="section-title text-[var(--color-production-heading)]">Production Notes From DeVaughn 🎬</h3>
                                            <div class="text-sm text-[var(--color-production-text)]">${formatTextAsList(allProdTidbits)}</div>
                                        </div>
                                    `;
                } else {
                     productionTidbitsSection.innerHTML = `<div class="content-block bg-[var(--color-production-bg)] border-[var(--color-production-border)]"><p class="text-gray-400">No Production Notes available for this episode.</p></div>`;
                }

            };

            const openModal = () => {
                const currentSelected = document.querySelector('.episode-item.selected');
                const currentEpisodeId = currentSelected ? currentSelected.dataset.episode : Object.keys(episodeData)[0];
                const data = episodeData[currentEpisodeId];

                if (!data) return;

                modalTitle.textContent = data.title;
                let modalContentHtml = '';

                if (data.thumbnail) {
                    modalContentHtml += `<div class="text-center mb-4">
                                                                            <img src="${data.thumbnail}" alt="Episode Thumbnail" class="thumbnail-style">
                                                                        </div>`;
                }

                // Synopsis Section for Modal
                if (data.synopsis && !isObjectEmpty(data.synopsis)) {
                    modalContentHtml += `
                                        <div class="content-block bg-[var(--color-synopsis-bg)] border-[var(--color-synopsis-border)]">
                                            <h3 class="section-title text-[var(--color-synopsis-heading)]">Game Design Topics Covered 🎮</h3>
                                            <div class="text-sm text-[var(--color-synopsis-text)]">${formatTextAsList(Object.values(data.synopsis).join('\\n'))}</div>
                                            <p class="mt-4 text-center">
                                                <a href="${data.url}" target="_blank" class="inline-block bg-transparent border border-indigo-500 text-indigo-highlight py-2 px-4 rounded-md hover:bg-indigo-900 hover:border-indigo-400 transition-colors duration-200">Watch Episode Here 📺</a>
                                            </p>
                                        </div>
                                    `;
                }

                // Episode Lore Section for Modal
                if (data.lore && !isObjectEmpty(data.lore)) {
                    modalContentHtml += `
                                        <div class="content-block bg-[var(--color-lore-bg)] border-[var(--color-lore-border)]">
                                            <h3 class="section-title text-[var(--color-lore-heading)]">Episode Lore/Story 📖</h3>
                                            <div class="text-sm text-[var(--color-lore-text)]">${formatTextAsList(Object.values(data.lore).join('\\n'))}</div>
                                        </div>
                                    `;
                }

                // Easter Eggs Section for Modal
                if (data.easter_eggs && !isObjectEmpty(data.easter_eggs)) {
                    modalContentHtml += `
                                        <div class="content-block bg-[var(--color-easter-eggs-bg)] border-[var(--color-easter-eggs-border)]">
                                            <h3 class="section-title text-[var(--color-easter-eggs-heading)]">Easter Eggs 🥚</h3>
                                            <div class="text-sm text-[var(--color-easter-eggs-text)]">${formatTextAsList(Object.values(data.easter_eggs).join('\\n'))}</div>
                                        </div>
                                    `;
                }

                // Production Tidbits Section for Modal
                const hasProductionDataForModal = data.production_tidbits && !isObjectEmpty(data.production_tidbits);
                const hasRecordingFactsForModal = data.recording_facts && data.recording_facts.toLowerCase() !== 'no';

                if (hasProductionDataForModal || hasRecordingFactsForModal) {
                    const allProdTidbitsForModal = [
                        data.production_tidbits.challenges,
                        data.production_tidbits.alternative_ideas,
                        data.recording_facts
                    ].filter(Boolean).join('\\n');

                    modalContentHtml += `
                                        <div class="content-block bg-[var(--color-production-bg)] border-[var(--color-production-border)]">
                                            <h3 class="section-title text-[var(--color-production-heading)]">Production Notes From DeVaughn 🎬</h3>
                                            <div class="text-sm text-[var(--color-production-text)]">${formatTextAsList(allProdTidbitsForModal)}</div>
                                        </div>
                                    `;
                } else {
                    modalContentHtml += `<div class="content-block bg-[var(--color-production-bg)] border-[var(--color-production-border)]"><p class="text-gray-400">No Production Tidbits information available for this episode.</p></div>`;
                }

                modalBody.innerHTML = modalContentHtml;
                infoModal.style.display = 'flex';
            };

            const closeModal = () => {
                infoModal.style.display = 'none';
            };

            const toggleEpisodeList = () => {
                episodeList.classList.toggle('expanded');
                if (episodeList.classList.contains('expanded')) {
                    episodeList.classList.remove('hidden');
                    toggleIcon.classList.replace('fa-chevron-down', 'fa-chevron-up');
                } else {
                    setTimeout(() => {
                        episodeList.classList.add('hidden');
                    }, 300);
                    toggleIcon.classList.replace('fa-chevron-up', 'fa-chevron-down');
                }
            };

            const handleResize = () => {
                if (isMobile()) {
                    episodeList.classList.add('hidden');
                    episodeList.classList.remove('expanded');
                    toggleIcon.classList.replace('fa-chevron-up', 'fa-chevron-down');
                    toggleEpisodesBtn.classList.remove('hidden');
                } else {
                    episodeList.classList.remove('hidden');
                    episodeList.classList.add('expanded');
                    toggleIcon.classList.replace('fa-chevron-down', 'fa-chevron-up');
                    toggleEpisodesBtn.classList.add('hidden');
                }
            };

            const populateEpisodeList = () => {
                episodeList.innerHTML = '';
                for (const episodeId in episodeData) {
                    const data = episodeData[episodeId];
                    const listItem = document.createElement('li');
                    listItem.classList.add('episode-item', 'cursor-pointer', 'mb-2');
                    listItem.dataset.episode = episodeId;

                    const match = data.title.match(/Season (\d+), Episode (\d+): (.+)/);
                    let seasonNum = '';
                    let episodeNum = '';
                    let actualTitle = data.title;
                    if (match) {
                        seasonNum = `S${match[1]}`;
                        episodeNum = `${match[2]}`;
                        actualTitle = match[3];
                    }

                    const snippet = data.synopsis.main;

                    listItem.innerHTML = `
                                        <div class="episode-number-badge">
                                            <div class="font-bold text-xs">${seasonNum}</div>
                                            <div class="font-extrabold text-xl text-indigo-400">${episodeNum}</div>
                                        </div>
                                        <div class="episode-details">
                                            <h3>${actualTitle}</h3>
                                            <p>${snippet}</p>
                                        </div>
                                    `;

                    listItem.addEventListener('mouseenter', () => {
                        listItem.querySelector('.episode-number-badge').classList.add('hovered-state');
                    });

                    listItem.addEventListener('mouseleave', () => {
                        listItem.querySelector('.episode-number-badge').classList.remove('hovered-state');
                    });

                    listItem.addEventListener('click', () => {
                        const currentSelected = document.querySelector('.episode-item.selected');
                        if (currentSelected) {
                            currentSelected.classList.remove('selected');
                            currentSelected.querySelector('.episode-number-badge').classList.remove('selected');
                        }
                        listItem.classList.add('selected');
                        listItem.querySelector('.episode-number-badge').classList.add('selected');
                    });

                    episodeList.appendChild(listItem);
                }
            };

            episodeList.addEventListener('click', (event) => {
                const item = event.target.closest('.episode-item');
                if (!item) return;

                const currentSelected = document.querySelector('.episode-item.selected');
                if (currentSelected) {
                    currentSelected.classList.remove('selected');
                    currentSelected.querySelector('.episode-number-badge').classList.remove('selected');
                }
                item.classList.add('selected');
                item.querySelector('.episode-number-badge').classList.add('selected');

                const episodeId = item.dataset.episode;
                updateInfoWindow(episodeId);

                if (isMobile()) {
                    setTimeout(() => {
                        episodeList.classList.add('hidden');
                    }, 300);
                    episodeList.classList.remove('expanded');
                    toggleIcon.classList.replace('fa-chevron-up', 'fa-chevron-down');
                }
            });

            maximizeBtn.addEventListener('click', openModal);
            closeBtn.addEventListener('click', closeModal);
            toggleEpisodesBtn.addEventListener('click', toggleEpisodeList);

            window.addEventListener('resize', handleResize);

            fetch('goc_lore_2.5.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    episodeData = data.reduce((acc, item) => {
                        const match = item.episodeTitle.match(/Season (\d+), Episode (\d+):/);
                        if (match) {
                            const seasonNum = parseInt(match[1]);
                            const episodeNum = parseInt(match[2]);
                            const episodeId = `s${seasonNum}e${episodeNum}`;

                            acc[episodeId] = {
                                title: item.episodeTitle || {},
                                snippet: (item.synopsisQuestions || {})["What is the primary game design concept or theme discussed in this episode?"],
                                url: item.youtubeUrl || {},
                                thumbnail: item.thumbnail || {},
                                synopsis: {
                                    main: (item.synopsisQuestions || {})["What is the primary game design concept or theme discussed in this episode?"],
                                    games_analyzed: (item.synopsisQuestions || {})["What specific games are analyzed, and what aspects of their design are highlighted in relation to the main concept?"],
                                    central_argument: (item.synopsisQuestions || {})["What is the central argument or key takeaway the episode makes about game design?"]
                                },
                                lore: {
                                    arc: (item.episodeLoreQuestions || {})["Does this episode have a specific 'story' or narrative arc beyond just the game design analysis?"],
                                    developments: (item.episodeLoreQuestions || {})["If applicable, are there any specific character developments, world-building elements, or recurring motifs introduced or expanded upon in this episode?"],
                                    meta_commentary: (item.episodeLoreQuestions || {})["Does the video's own narrative offer any meta-commentary on the themes of the series or the act of creating content?"]
                                },
                                easter_eggs: {
                                    visual_audio: (item.easterEggsQuestions|| {})["Are there any specific visual or audio Easter eggs in this episode (e.g., hidden references in the background, specific props, subtle audio cues)?"],
                                    nods: (item.easterEggsQuestions || {})["Are there any subtle nods to previous episodes, future content, or meta-references within the series itself?"],
                                    inside_jokes: (item.easterEggsQuestions || {})["Are there any inside jokes or community references integrated into this episode?"]
                                },
                                production_tidbits: {
                                    challenges: (item.productionTidbitsQuestions || {})["What was a notable challenge or interesting aspect during the production of this episode (e.g., research difficulty, specific editing techniques, unexpected discoveries during analysis)?"],
                                    alternative_ideas: (item.productionTidbitsQuestions || {})["Were there any alternative ideas or unused concepts for this episode that were considered and then discarded?"]
                                },
                                recording_facts: (item.productionTidbitsQuestions || {})["Any interesting facts about the recording process, script writing, or asset creation for this particular video?"],
                                characters: item.episodeCharacters || [],
                                locations: item.episodeLocations || []
                            };
                        }
                        return acc;
                    }, {});

                    populateEpisodeList();
                    handleResize();

                    const firstEpisode = document.querySelector('.episode-item');
                    if (firstEpisode) {
                        firstEpisode.classList.add('selected');
                        firstEpisode.querySelector('.episode-number-badge').classList.add('selected');
                        updateInfoWindow(firstEpisode.dataset.episode);
                    } else {
                        initialMessage.classList.remove('hidden');
                    }
                })
                .catch(error => {
                    console.error('Error fetching episode data:', error);
                    initialMessage.textContent = 'Failed to load episode data. Please try again later.';
                    initialMessage.classList.remove('hidden');
                });
        });
    </script>
</body>
</html>